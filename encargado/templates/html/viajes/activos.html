{% extends 'base_encargado.html' %}
{% load static %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Viajes activos</h2>
    <a class="btn btn-primary" href="{% url 'encargado:nuevo_viaje' %}">Nuevo viaje</a>
  </div>

  {% if viajes %}
    {% for entry in viajes %}
      <div class="card mb-3">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div><strong>Viaje #{{ entry.viaje.id }}</strong> • {{ entry.viaje.fecha|date:"d/m/Y H:i" }}</div>
              <div class="text-muted">Chofer: {{ entry.viaje.chofer }} • Ayudante: {{ entry.viaje.ayudante }} • Camión: {{ entry.viaje.camion_viaje }}</div>
            </div>
            <div>
              <a href="{% url 'encargado:gestionar_viaje' entry.viaje.id %}" class="btn btn-outline-secondary">Gestionar</a>
            </div>
          </div>
          <hr>
          <div>
            <h6 class="mb-2">Pedidos activos ({{ entry.cantidad_pedidos }})</h6>
            <div class="table-responsive">
              <table class="table table-sm mb-0">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Cliente</th>
                    <th>Destino</th>
                    <th>Items</th>
                  </tr>
                </thead>
                <tbody>
                  {% for p in entry.pedidos %}
                    <tr>
                      <td>#{{ p.id }}</td>
                      <td>{{ p.cliente.nombre }} {{ p.cliente.apellido }}</td>
                      <td>{{ p.cliente.comercio.nombre }}</td>
                      <td>{{ p.detallepedido_set.count }}</td>
                    </tr>
                  {% empty %}
                    <tr><td colspan="4" class="text-center">Sin pedidos</td></tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="alert alert-info">No hay viajes activos.</div>
  {% endif %}
</div>
{% endblock %}
